!function(t){var r={timer:!1,form_checkout:t(document).find("form.checkout")||t(document).find("form.woocommerce-checkout"),init:function(){t("form.woocommerce-checkout").length&&(this.form=t("form.woocommerce-checkout")),t(document.body).on("pace_transaction_error",this.onError),t("form.woocommerce-checkout").on("checkout_place_order_pace",this.transaction)},getAjaxURL:function(o){return wc_pace_params.ajaxurl.toString().replace("%%endpoint%%","wc_pace_"+o)},create_transaction:function(){var e=[],c=r.form.serializeArray();Object.keys(c).map(function(o){e[c[o].name]=t.trim(c[o].value)}),e.security=wc_pace_params.pace_nonce,e=Object.assign({},e),t.ajax({url:r.getAjaxURL("create_transaction"),type:"post",data:e,success:function(o){o.success?r.showPopup(o):t(document.body).trigger("pace_transaction_error",o)}})},transaction:function(){return!r.isChosen()||(!!r.hasTransaction()||(r.block(),r.create_transaction(),!1))},showPopup:function(o){var e=o.data.paymentLink.replace(/.*txn=/gm,"");pacePay.showProgressModal(),pacePay.popup({txnToken:e,onSuccess:function(o){r.transaction_completed(o)},onCancel:function(){r.transaction_cancelled()},onLoad:function(){pacePay.hideProgressModal()}})},preprareSource:function(o){r.reset();var e=t('<input type="hidden" />').addClass("pace-transaction").attr("name","pace_transaction").val(JSON.stringify(o));r.form.append(e),t("form#add_payment_method").length&&t(r.form).off("submit",r.form.onSubmit),r.form.submit()},transaction_completed:function(o){o.status="success",r.preprareSource(o),t(document.body).trigger("wc_pace_action_after_create_transaction",[o])},transaction_cancelled:function(){t.ajax({url:r.getAjaxURL("cancelled_order"),type:"POST",success:function(o){o.success||t(document.body).trigger("pace_transaction_error",[o]);var e=o.data.redirect;-1===e.indexOf("https://")||-1===e.indexOf("http://")?window.location=e:window.location=decodeURI(e)}})},isChosen:function(){return t("#payment_method_pace").is(":checked")},hasTransaction:function(){return 0<t(document.body).find("input.pace-transaction").length},isMobile:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},block:function(){r.isMobile()||r.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unBlock:function(){r.form&&r.form.unblock()},onError:function(o,e){var c=e.data.message,n=t('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout"></div>').html(t(c).addClass("woocommerce-error wc-pace-error"));t(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),r.form.prepend(n),t(".wc-pace-error").length&&t("html, body").animate({scrollTop:t(".wc-pace-error").offset().top-200},200),r.unBlock()},reset:function(){t(document.body).find(".pace-transaction").remove()}};r.init()}(jQuery);