!function(e){var o={timer:!1,form_checkout:e(document).find("form.checkout")||e(document).find("form.woocommerce-checkout"),init:function(){e("form.woocommerce-checkout").length&&(this.form=e("form.woocommerce-checkout")),e(document.body).on("pace_transaction_error",this.onError),e("form.woocommerce-checkout").on("checkout_place_order_pace",this.transaction)},getAjaxURL:function(e){return wc_pace_params.ajaxurl.toString().replace("%%endpoint%%","wc_pace_"+e)},create_transaction:function(){var c=[],t=o.form.serializeArray();Object.keys(t).map(function(o){c[t[o].name]=e.trim(t[o].value)}),c.security=wc_pace_params.pace_nonce,c=Object.assign({},c),e.ajax({url:o.getAjaxURL("create_transaction"),type:"post",data:c,success:function(c){if(c.success)switch(wc_pace_params.checkout_mode){case"popup":o.showPopup(c);break;case"redirect":window.location.href=c.data.paymentLink;break;default:console.log("Awaiting for Pace transaction")}else e(document.body).trigger("pace_transaction_error",c)}})},transaction:function(){return!o.isChosen()||(!!o.hasTransaction()||(o.block(),o.create_transaction(),!1))},showPopup:function(e){var c=e.data.paymentLink.replace(/.*txn=/gm,"");pacePay.showProgressModal(),pacePay.popup({txnToken:c,onSuccess:function(e){o.transaction_completed(e)},onCancel:function(){o.transaction_cancelled(e)},onLoad:function(){pacePay.hideProgressModal()}})},preprareSource:function(c){o.reset();var t=e('<input type="hidden" />').addClass("pace-transaction").attr("name","pace_transaction").val(JSON.stringify(c));o.form.append(t),e("form#add_payment_method").length&&e(o.form).off("submit",o.form.onSubmit),o.form.submit()},transaction_completed:function(c){c.status="success",o.preprareSource(c),e(document.body).trigger("wc_pace_action_after_create_transaction",[c])},transaction_cancelled:function(c){e.ajax({url:o.getAjaxURL("cancelled_order"),type:"POST",data:c,success:function(o){o.success||e(document.body).trigger("pace_transaction_error",[o]);var c=o.data.redirect;-1===c.indexOf("https://")||-1===c.indexOf("http://")?window.location=c:window.location=decodeURI(c)}})},isChosen:function(){return e("#payment_method_pace").is(":checked")},hasTransaction:function(){return e(document.body).find("input.pace-transaction").length>0},isMobile:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},block:function(){o.isMobile()||o.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unBlock:function(){o.form&&o.form.unblock()},onError:function(c,t){var n=t.data.message,r=e('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout"></div>').html(e(n).addClass("woocommerce-error wc-pace-error"));e(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),o.form.prepend(r),e(".wc-pace-error").length&&e("html, body").animate({scrollTop:e(".wc-pace-error").offset().top-200},200),o.unBlock()},reset:function(){e(document.body).find(".pace-transaction").remove()}};o.init()}(jQuery);