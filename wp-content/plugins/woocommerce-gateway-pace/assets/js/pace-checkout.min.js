!function(o){var e={timer:!1,form_checkout:o(document).find("form.checkout")||o(document).find("form.woocommerce-checkout"),init:function(){o("form.woocommerce-checkout").length&&(this.form=o("form.woocommerce-checkout")),o(document.body).on("pace_transaction_error",this.onError),o("form.woocommerce-checkout").on("checkout_place_order_pace",this.transaction)},getAjaxURL:function(o){return wc_pace_params.ajaxurl.toString().replace("%%endpoint%%","wc_pace_"+o)},create_transaction:function(){var c=[],t=e.form.serializeArray();Object.keys(t).map(function(e){c[t[e].name]=o.trim(t[e].value)}),c.security=wc_pace_params.pace_nonce,c=Object.assign({},c),o.ajax({url:e.getAjaxURL("create_transaction"),type:"post",data:c,success:function(c){c.success?e.showPopup(c):o(document.body).trigger("pace_transaction_error",c)}})},transaction:function(){return!e.isChosen()||(!!e.hasTransaction()||(e.block(),e.create_transaction(),!1))},showPopup:function(o){var c=o.data.paymentLink.replace(/.*txn=/gm,"");pacePay.showProgressModal(),pacePay.popup({txnToken:c,onSuccess:function(o){e.transaction_completed(o)},onCancel:function(){e.transaction_cancelled(o)},onLoad:function(){pacePay.hideProgressModal()}})},preprareSource:function(c){e.reset();var t=o('<input type="hidden" />').addClass("pace-transaction").attr("name","pace_transaction").val(JSON.stringify(c));e.form.append(t),o("form#add_payment_method").length&&o(e.form).off("submit",e.form.onSubmit),e.form.submit()},transaction_completed:function(c){c.status="success",e.preprareSource(c),o(document.body).trigger("wc_pace_action_after_create_transaction",[c])},transaction_cancelled:function(c){o.ajax({url:e.getAjaxURL("cancelled_order"),type:"POST",data:c,success:function(e){e.success||o(document.body).trigger("pace_transaction_error",[e]);var c=e.data.redirect;-1===c.indexOf("https://")||-1===c.indexOf("http://")?window.location=c:window.location=decodeURI(c)}})},isChosen:function(){return o("#payment_method_pace").is(":checked")},hasTransaction:function(){return o(document.body).find("input.pace-transaction").length>0},isMobile:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},block:function(){e.isMobile()||e.form.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unBlock:function(){e.form&&e.form.unblock()},onError:function(c,t){var n=t.data.message,r=o('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout"></div>').html(o(n).addClass("woocommerce-error wc-pace-error"));o(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),e.form.prepend(r),o(".wc-pace-error").length&&o("html, body").animate({scrollTop:o(".wc-pace-error").offset().top-200},200),e.unBlock()},reset:function(){o(document.body).find(".pace-transaction").remove()}};e.init()}(jQuery);